# API调试指南

## 问题诊断

根据后端API代码，我已经修复了以下问题：

### 1. 响应结构不匹配
- **问题**: 后端使用 `Response(data=...)` 包装器
- **修复**: 更新了响应拦截器和数据解析逻辑

### 2. 会话ID字段不一致
- **问题**: 后端可能返回 `id` 或 `session_id`
- **修复**: 兼容处理两种字段名

### 3. 流式响应格式
- **问题**: 后端直接发送文本内容，不需要特殊session_id处理
- **修复**: 简化了流式响应解析

### 4. 文件上传响应
- **问题**: 后端返回不同的响应结构
- **修复**: 更新了文件上传结果解析

## 调试步骤

### 1. 启动开发服务器
```bash
npm run dev
```

### 2. 打开浏览器控制台
按F12打开开发者工具，查看Console标签

### 3. 运行API测试
在控制台中输入：
```javascript
window.runAPITests()
```

### 4. 查看调试信息
现在所有API调用都会在控制台输出详细信息：
- 请求信息（方法、URL、数据）
- 响应信息（状态、数据）
- 错误信息（如果有）

## 常见问题排查

### 1. 网络连接问题
- 检查后端服务是否启动
- 确认API基础路径 `/api` 是否正确
- 检查代理配置（如果使用）

### 2. 会话管理问题
- 查看控制台中的会话列表响应
- 确认会话ID字段名（id vs session_id）
- 检查会话详情API响应格式

### 3. 文件上传问题
- 确认文件类型是否支持（.txt, .md, .docx）
- 检查文件大小限制（10MB）
- 查看上传响应中的错误信息

### 4. 流式对话问题
- 检查SSE连接是否建立
- 确认后端流式响应格式
- 查看控制台中的流式数据

## 修复的关键点

1. **API响应拦截器**: 正确处理后端的Response包装器
2. **会话管理**: 兼容不同的会话ID字段名
3. **流式响应**: 简化了数据解析逻辑
4. **错误处理**: 增强了错误信息显示
5. **调试信息**: 添加了详细的控制台日志

## 下一步

1. 测试所有功能是否正常工作
2. 根据控制台输出调整API集成
3. 移除调试代码（生产环境）
4. 优化错误处理和用户体验